{"version":3,"file":"traces.js","sourceRoot":"","sources":["../../../../src/testing/internal/profile/traces.ts"],"names":[],"mappings":"AAIA,MAAM,UAAU,iBAAiB,CAAC,eAAqC;IACrE,IAAI,KAAK,GAAG,EAAE,CAAC;IACf,IAAI;QACF,MAAM,IAAI,KAAK,CAAC,EAAE,CAAC,CAAC;KACrB;IAAC,OAAO,CAAM,EAAE;QACf,CAAG,KAAK,GAAK,CAAC,MAAN,CAAO,CAAC;KACjB;IAED,IAAM,UAAU,GACd,OAAO,eAAe,KAAK,QAAQ;QACjC,CAAC,CAAC,eAAe;QACjB,CAAC,CAAC,eAAe;YACjB,CAAC,CAAC,eAAe,CAAC,IAAI;YACtB,CAAC,CAAC,SAAS,CAAC;IAEhB,IAAI,UAAU,IAAI,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;QAC5C,IAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAEhC,KAAK,GAAG,KAAK;aACV,KAAK,CAEJ,KAAK,CAAC,aAAa,CAAC,UAAC,IAAY,IAAK,OAAA,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAzB,CAAyB,CAAC,GAAG,CAAC,CACrE;aACA,IAAI,CAAC,IAAI,CAAC,CAAC;KACf;IAED,OAAO,KAAK,CAAC;AACf,CAAC;AAED,MAAM,UAAU,eAAe,CAAC,KAAY,EAAE,UAAkB;IAC9D,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,OAAO,GAAG,IAAI,GAAG,UAAU,CAAC;IAChD,OAAO,KAAK,CAAC;AACf,CAAC","sourcesContent":["/**\n * Captures a StackTrace and (if passed) cuts off\n * the first lines including the calling function.\n */\nexport function captureStackTrace(callingFunction?: string | (() => {})) {\n  let stack = \"\";\n  try {\n    throw new Error(\"\");\n  } catch (e: any) {\n    ({ stack } = e);\n  }\n\n  const callerName =\n    typeof callingFunction === \"string\"\n      ? callingFunction\n      : callingFunction\n      ? callingFunction.name\n      : undefined;\n\n  if (callerName && stack.includes(callerName)) {\n    const lines = stack.split(\"\\n\");\n\n    stack = lines\n      .slice(\n        // @ts-expect-error this is too old of a TS target, but node has it\n        lines.findLastIndex((line: string) => line.includes(callerName)) + 1\n      )\n      .join(\"\\n\");\n  }\n\n  return stack;\n}\n\nexport function applyStackTrace(error: Error, stackTrace: string) {\n  error.stack = error.message + \"\\n\" + stackTrace;\n  return error;\n}\n"]}