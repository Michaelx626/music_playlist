{"version":3,"file":"ProfiledComponent.js","sourceRoot":"","sources":["../../../src/testing/matchers/ProfiledComponent.ts"],"names":[],"mappings":";AACA,OAAO,EAAE,yBAAyB,EAAE,MAAM,sBAAsB,CAAC;AAMjE,MAAM,CAAC,IAAM,UAAU,GACrB,UACE,SAA+D,EAC/D,OAA2B;;;;;;oBAErB,QAAQ,GACZ,mBAAmB,IAAI,SAAS;wBAC9B,CAAC,CAAC,SAAS,CAAC,iBAAiB;wBAC7B,CAAC,CAAC,SAAS,CAAC;oBACV,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;oBAC9C,IAAI,GAAG,IAAI,CAAC;;;;oBAEd,WAAM,QAAQ,CAAC,UAAU,YAAG,OAAO,EAAE,GAAG,IAAK,OAAO,EAAG,EAAA;;oBAAvD,SAAuD,CAAC;;;;oBAExD,IAAI,GAAC,YAAY,yBAAyB,EAAE;wBAC1C,IAAI,GAAG,KAAK,CAAC;qBACd;yBAAM;wBACL,MAAM,GAAC,CAAC;qBACT;;wBAEH,WAAO;wBACL,IAAI,MAAA;wBACJ,OAAO;4BACL,OAAO,CACL,IAAI;gCACJ,gCAAyB,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,gBAAa;gCACxD,oBAAa,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,MAAG,CACnC,CAAC;wBACJ,CAAC;qBACF,EAAC;;;;CACH,CAAC;AAGJ,IAAM,MAAM,GAAG,EAAE,CAAC;AAElB,MAAM,CAAC,IAAM,oBAAoB,GAE7B,UACF,SAA+D,EAC/D,KAAa,EACb,gBAAoC;;;;;;oBAE9B,QAAQ,GACZ,mBAAmB,IAAI,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC,CAAC,SAAS,CAAC;oBACvE,OAAO,cAAK,OAAO,EAAE,GAAG,IAAK,gBAAgB,CAAE,CAAC;oBAChD,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;oBACxD,IAAI,GAAG,IAAI,CAAC;;;;oBAEd,IAAI,QAAQ,CAAC,kBAAkB,EAAE,GAAG,KAAK,EAAE;wBACzC,MAAM,MAAM,CAAC;qBACd;;;;;;yBAEQ,CAAA,QAAQ,CAAC,kBAAkB,EAAE,GAAG,KAAK,CAAA;oBAC1C,WAAM,QAAQ,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAA;;oBAAzC,SAAyC,CAAC;;;;;oBAI5C,MAAM,GAAC,YAAY,yBAAyB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAC,CAAC;;;oBAG1D,WAAM,QAAQ,CAAC,iBAAiB,CAAC,OAAO,CAAC,EAAA;;oBAAzC,SAAyC,CAAC;;;;oBAG1C,IAAI,CAAC,CAAC,GAAC,YAAY,yBAAyB,CAAC,EAAE;wBAC7C,MAAM,GAAC,CAAC;qBACT;;;;;oBAGH,IAAI,GAAC,KAAK,MAAM,EAAE;wBAChB,IAAI,GAAG,KAAK,CAAC;qBACd;yBAAM;wBACL,MAAM,GAAC,CAAC;qBACT;;yBAEH,WAAO;wBACL,IAAI,MAAA;wBACJ,OAAO;4BACL,OAAO,CACL,IAAI;gCACJ,gCAAyB,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,6BAAmB,KAAK,MAAG;gCACtE,uBAAgB,QAAQ,CAAC,kBAAkB,EAAE,YAAS,CACvD,CAAC;wBACJ,CAAC;qBACF,EAAC;;;;CACH,CAAC","sourcesContent":["import type { MatcherFunction } from \"expect\";\nimport { WaitForRenderTimeoutError } from \"../internal/index.js\";\nimport type {\n  NextRenderOptions,\n  ProfiledComponent,\n  ProfiledHook,\n} from \"../internal/index.js\";\nexport const toRerender: MatcherFunction<[options?: NextRenderOptions]> =\n  async function (\n    _profiled: ProfiledComponent<any, any> | ProfiledHook<any, any>,\n    options?: NextRenderOptions\n  ) {\n    const profiled =\n      \"ProfiledComponent\" in _profiled\n        ? _profiled.ProfiledComponent\n        : _profiled;\n    const hint = this.utils.matcherHint(\"toRerender\");\n    let pass = true;\n    try {\n      await profiled.peekRender({ timeout: 100, ...options });\n    } catch (e) {\n      if (e instanceof WaitForRenderTimeoutError) {\n        pass = false;\n      } else {\n        throw e;\n      }\n    }\n    return {\n      pass,\n      message() {\n        return (\n          hint +\n          ` Expected component to${pass ? \" not\" : \"\"} rerender, ` +\n          `but it did${pass ? \"\" : \" not\"}.`\n        );\n      },\n    };\n  };\n\n/** to be thrown to \"break\" test execution and fail it */\nconst failed = {};\n\nexport const toRenderExactlyTimes: MatcherFunction<\n  [times: number, options?: NextRenderOptions]\n> = async function (\n  _profiled: ProfiledComponent<any, any> | ProfiledHook<any, any>,\n  times: number,\n  optionsPerRender?: NextRenderOptions\n) {\n  const profiled =\n    \"ProfiledComponent\" in _profiled ? _profiled.ProfiledComponent : _profiled;\n  const options = { timeout: 100, ...optionsPerRender };\n  const hint = this.utils.matcherHint(\"toRenderExactlyTimes\");\n  let pass = true;\n  try {\n    if (profiled.currentRenderCount() > times) {\n      throw failed;\n    }\n    try {\n      while (profiled.currentRenderCount() < times) {\n        await profiled.waitForNextRender(options);\n      }\n    } catch (e) {\n      // timeouts here should just fail the test, rethrow other errors\n      throw e instanceof WaitForRenderTimeoutError ? failed : e;\n    }\n    try {\n      await profiled.waitForNextRender(options);\n    } catch (e) {\n      // we are expecting a timeout here, so swallow that error, rethrow others\n      if (!(e instanceof WaitForRenderTimeoutError)) {\n        throw e;\n      }\n    }\n  } catch (e) {\n    if (e === failed) {\n      pass = false;\n    } else {\n      throw e;\n    }\n  }\n  return {\n    pass,\n    message() {\n      return (\n        hint +\n        ` Expected component to${pass ? \" not\" : \"\"} render exactly ${times}.` +\n        ` It rendered ${profiled.currentRenderCount()} times.`\n      );\n    },\n  };\n};\n"]}